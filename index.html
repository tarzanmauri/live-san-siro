<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Diretta San Siro Nervi U14</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root { color-scheme: dark; }
    * { box-sizing:border-box; }
    body {
      margin: 0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#0b0b0b;
      color:#f5f5f5;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: #000;
      padding: 10px 14px;
      border-bottom: 1px solid #222;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .brand {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.06em;
    }
    .brand span { color:#e50914; }
    .tag-cat {
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #333;
      background: #111;
    }
    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 14px 10px 40px;
    }
    h2 {
      font-size: 18px;
      margin: 18px 0 10px;
    }
    .sub {
      font-size: 12px;
      color: #aaa;
    }
    #nextMatchBox {
      background: #181818;
      border-radius: 12px;
      padding: 12px 14px;
      border: 1px solid #262626;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .nm-title { font-size:14px;font-weight:600; }
    #countdown {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 22px;
      font-weight: 700;
    }
    .pill {
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      border:1px solid #444;
    }
    .pill-live { border-color:#e50914;color:#e50914; }
    .pill-pre { border-color:#888;color:#bbb; }
    .pill-fin { border-color:#4caf50;color:#4caf50; }

    .box{
      background:#181818;
      border-radius:10px;
      border:1px solid #262626;
      padding:10px 12px;
      margin-bottom:10px;
      font-size:14px;
    }

    .match-list { display:flex;flex-direction:column;gap:8px; }
    .match-card {
      background:#181818;
      border-radius:10px;
      padding:10px 12px;
      border:1px solid #262626;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .match-header {
      display:flex;
      justify-content:space-between;
      font-size:11px;
      color:#aaa;
    }
    .match-round { font-weight:600;color:#f5f5f5; }
    .teams-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:5px;
    }
    .team-name { font-size:14px;font-weight:500; }
    .team-name.sansiro { font-weight:700; }
    .score {
      font-size:20px;
      font-weight:700;
      min-width:60px;
      text-align:center;
    }
    .status-row {
      font-size:11px;
      color:#888;
    }

    .evt-row {
      padding: 4px 0;
      border-bottom: 1px solid #262626;
      font-size: 13px;
    }

    footer{
      text-align:center;
      font-size:11px;
      color:#666;
      padding:10px 0 18px;
    }

    @media (max-width:600px){
      header{
        flex-direction:column;
        align-items:flex-start;
        gap:4px;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="brand">DIRETTA <span>SAN SIRO</span> U14</div>
  <div class="tag-cat">Campionato 2025/26</div>
</header>

<main>
  <h2>Prossima partita</h2>
  <div id="nextMatchBox">
    <div class="nm-title" id="nextMatchInfo">Caricamento…</div>
    <div id="countdown">--:--:--</div>
    <div id="nextMatchStatus" class="sub"></div>
  </div>

  <h2>Partita di oggi</h2>
  <div id="todayMatchBox" class="box">
    <div class="sub">Nessuna partita in programma per oggi.</div>
  </div>

  <h2>Tutte le partite U14</h2>
  <div class="sub" style="margin-bottom:6px;">
    Risultati e stato aggiornati dal mister in tempo reale.
  </div>
  <div id="matchesList" class="match-list"></div>
</main>

<footer>
  Diretta San Siro Nervi U14 – dati gestiti in locale dal mister
</footer>

<script>
  const STORAGE_KEY = "ssn_matches_v2";

  const PLAYERS = [
    { number: 1,  name: "Perez Sanabria Erik Joshue" },
    { number: 2,  name: "Beux Nicholas" },
    { number: 4,  name: "Cerfogli Elio" },
    { number: 5,  name: "Risso Leonardo" },
    { number: 6,  name: "Maro Terenui Luca" },
    { number: 7,  name: "Lanini Gabriele" },
    { number: 8,  name: "Vitarelli Alessandro" },
    { number: 9,  name: "Meazzi Timoteo" },
    { number: 10, name: "Ronda Rocco" },
    { number: 11, name: "Rebaudengo Amedeo" },
    { number: 12, name: "Micucci Emanuele" },
    { number: 18, name: "Meazzi Geremi" },
    { number: 25, name: "Panebianco Edoardo" },
    { number: 35, name: "Buzzi Diego" },
    { number: 77, name: "Cota Levis" },
    { number: 80, name: "Bruci Samuel" },
    { number: 99, name: "Vitarelli Andrea" }
  ];

  const baseMatches = [
    {
      id: 1,
      round: "1ª giornata",
      dateTime: "2025-10-18T10:00:00",
      category: "U14",
      field: "Campo Meja",
      homeTeam: "San Marziano",
      awayTeam: "San Siro Nervi U14",
      homeScore: 1,
      awayScore: 1,
      status: "FIN",
      seconds: 0,
      goals: [
        { team: "away", name: "Edoardo Panebianco", goals: 1 }
      ],
      assists: [
        { team: "away", name: "Meazzi Timoteo", assists: 1 }
      ],
      events: [],
      lineup: { players: {} }
    },
    {
      id: 2,
      round: "2ª giornata",
      dateTime: "2025-10-26T16:30:00",
      category: "U14",
      field: "Campo Emiliani",
      homeTeam: "San Siro Nervi U14",
      awayTeam: "Fulgor Gialli U14",
      homeScore: 8,
      awayScore: 1,
      status: "FIN",
      seconds: 0,
      goals: [
        { team: "home", name: "Meazzi Timoteo", goals: 5 },
        { team: "home", name: "Ronda Rocco", goals: 1 },
        { team: "home", name: "Rebaudengo Amedeo", goals: 1 },
        { team: "home", name: "Vitarelli Andrea", goals: 1 }
      ],
      assists: [
        { team: "home", name: "Buzzi Diego", assists: 1 },
        { team: "home", name: "Vitarelli Alessandro", assists: 2 },
        { team: "home", name: "Rebaudengo Amedeo", assists: 3 }
      ],
      events: [],
      lineup: { players: {} }
    },
    {
      id: 3,
      round: "3ª giornata",
      dateTime: "2025-11-09T10:00:00",
      category: "U14",
      field: "Sestri Ponente",
      homeTeam: "San Giovanni Battista U14",
      awayTeam: "San Siro Nervi U14",
      homeScore: 5,
      awayScore: 6,
      status: "FIN",
      seconds: 0,
      goals: [
        { team: "away", name: "Ronda Rocco", goals: 4 },
        { team: "away", name: "Vitarelli Andrea", goals: 1 },
        { team: "away", name: "Vitarelli Alessandro", goals: 1 }
      ],
      assists: [
        { team: "away", name: "Lanini Gabriele", assists: 1 },
        { team: "away", name: "Vitarelli Alessandro", assists: 1 },
        { team: "away", name: "Rebaudengo Amedeo", assists: 1 }
      ],
      events: [],
      lineup: { players: {} }
    },
    {
      id: 4,
      round: "4ª giornata",
      dateTime: "2025-11-23T16:30:00",
      category: "U14",
      field: "Campo Emiliani",
      homeTeam: "San Siro Nervi U14",
      awayTeam: "Genova SC Albaro",
      homeScore: null,
      awayScore: null,
      status: "PRE",
      seconds: 0,
      goals: [],
      assists: [],
      events: [],
      lineup: { players: {} }
    },
    {
      id: 5,
      round: "5ª giornata",
      dateTime: "2025-11-30T10:30:00",
      category: "U14",
      field: "Campo Fumeri",
      homeTeam: "Fulgor Verdi U14",
      awayTeam: "San Siro Nervi U14",
      homeScore: null,
      awayScore: null,
      status: "PRE",
      seconds: 0,
      goals: [],
      assists: [],
      events: [],
      lineup: { players: {} }
    },
    {
      id: 6,
      round: "6ª giornata (riposo)",
      dateTime: "2025-12-14T00:00:00",
      category: "U14",
      field: "Riposo",
      homeTeam: "San Siro Nervi U14",
      awayTeam: "—",
      homeScore: null,
      awayScore: null,
      status: "PRE",
      seconds: 0,
      goals: [],
      assists: [],
      events: [],
      lineup: { players: {} }
    },
    {
      id: 7,
      round: "7ª giornata",
      dateTime: "2025-12-21T16:30:00",
      category: "U14",
      field: "Campo Emiliani",
      homeTeam: "San Siro Nervi U14",
      awayTeam: "Polisportiva Pieve",
      homeScore: null,
      awayScore: null,
      status: "PRE",
      seconds: 0,
      goals: [],
      assists: [],
      events: [],
      lineup: { players: {} }
    }
  ];

  function deepClone(o){return JSON.parse(JSON.stringify(o));}
  function loadMatches(){
    try{
      const raw=localStorage.getItem(STORAGE_KEY);
      if(!raw) return deepClone(baseMatches);
      const parsed=JSON.parse(raw);
      if(!Array.isArray(parsed)||!parsed.length) return deepClone(baseMatches);
      return parsed;
    }catch(e){
      return deepClone(baseMatches);
    }
  }

  let matches = loadMatches();
  let countdownInterval=null;

  function formatDateTime(dtStr){
    const d=new Date(dtStr);
    if(isNaN(d))return dtStr;
    const gg=String(d.getDate()).padStart(2,"0");
    const mm=String(d.getMonth()+1).padStart(2,"0");
    const hh=String(d.getHours()).padStart(2,"0");
    const mi=String(d.getMinutes()).padStart(2,"0");
    return `${gg}/${mm}/${d.getFullYear()} • ${hh}:${mi}`;
  }
  function formatCountdown(diffMs){
    let totalSeconds=Math.max(0,Math.floor(diffMs/1000));
    const hh=String(Math.floor(totalSeconds/3600)).padStart(2,"0");
    totalSeconds%=3600;
    const mm=String(Math.floor(totalSeconds/60)).padStart(2,"0");
    const ss=String(totalSeconds%60).padStart(2,"0");
    return `${hh}:${mm}:${ss}`;
  }
  function formatTimer(sec){
    const s=sec||0;
    const mm=String(Math.floor(s/60)).padStart(2,"0");
    const ss=String(s%60).padStart(2,"0");
    return `${mm}:${ss}`;
  }

  function getNextMatch(){
    const now=new Date();
    const upcoming=matches
      .map(m=>({...m,dt:new Date(m.dateTime)}))
      .filter(m=>m.status==="PRE" && m.dt>now)
      .sort((a,b)=>a.dt-b.dt);
    return upcoming[0]||null;
  }

  function getTodayMatch(){
    const now=new Date();
    return matches.find(m=>{
      const d=new Date(m.dateTime);
      return d.getFullYear()===now.getFullYear() &&
             d.getMonth()===now.getMonth() &&
             d.getDate()===now.getDate();
    })||null;
  }

  function renderCountdown(){
    const info=document.getElementById("nextMatchInfo");
    const cd=document.getElementById("countdown");
    const st=document.getElementById("nextMatchStatus");
    if(countdownInterval)clearInterval(countdownInterval);

    const next=getNextMatch();
    if(!next){
      info.textContent="Nessuna partita in programma.";
      cd.textContent="--:--:--";
      st.textContent="";
      return;
    }

    const dt=new Date(next.dateTime);
    info.textContent=`${next.round} • ${next.homeTeam} vs ${next.awayTeam} (${formatDateTime(next.dateTime)})`;

    function update(){
      const now=new Date();
      const match = matches.find(m=>m.id===next.id) || next;
      if(match.status==="LIVE"){
        cd.textContent="IN CORSO";
        st.innerHTML=`<span class="pill pill-live">LIVE</span>`;
        return;
      }
      if(match.status==="FIN"){
        cd.textContent="PARTITA TERMINATA";
        st.innerHTML=`<span class="pill pill-fin">Terminata</span>`;
        return;
      }
      const diff=dt-now;
      if(diff<=0){
        cd.textContent="Pronta a partire…";
        st.innerHTML=`<span class="pill pill-pre">Attesa calcio d'inizio</span>`;
        return;
      }
      cd.textContent=formatCountdown(diff);
      st.innerHTML=`<span class="pill pill-pre">Mancano</span>`;
    }
    update();
    countdownInterval=setInterval(update,1000);
  }

  function getLineup(m){
    const players = (m.lineup && m.lineup.players) ? m.lineup.players : {};
    const starters=[];
    const bench=[];
    const order=["POR","TD","TS","DC","SP","TRQ","FW"];

    PLAYERS.forEach(p=>{
      const info=players[p.number] || {starter:false, role:""};
      if(info.starter){
        starters.push({
          number:p.number,
          name:p.name,
          role:info.role || ""
        });
      }else{
        bench.push({
          number:p.number,
          name:p.name
        });
      }
    });

    starters.sort((a,b)=>{
      const ia=order.indexOf(a.role);
      const ib=order.indexOf(b.role);
      return (ia<0?99:ia)-(ib<0?99:ib);
    });

    return {starters, bench};
  }

  function renderTodayMatch(){
    const box=document.getElementById("todayMatchBox");
    const m=getTodayMatch();
    if(!m){
      box.innerHTML=`<div class="sub">Nessuna partita in programma per oggi.</div>`;
      return;
    }
    const home=(m.homeScore==null)?"-":m.homeScore;
    const away=(m.awayScore==null)?"-":m.awayScore;
    const lu=getLineup(m);
    const events=(m.events||[]).slice().sort((a,b)=>(a.minute||0)-(b.minute||0));

    const marcatori=(m.goals||[]).length
      ? (m.goals||[]).map(g=>`${g.team==="home"?"San Siro":"Avversari"} – ${g.name} (${g.goals})`).join("<br>")
      : "—";


    const assistHtml = (m.assists||[]).length
      ? (m.assists||[]).map(a=>`${a.name} (${a.assists})`).join("<br>")
      : "—";

    const cronacaHtml = events.length
      ? events.map(e=>`<div class="evt-row"><b>${e.minute}'</b> — ${e.text}</div>`).join("")
      : "<i style='color:#999;'>Ancora nessuna azione registrata.</i>";

    box.innerHTML = `
      <div style="font-size:16px;font-weight:700;margin-bottom:4px;">
        ${m.homeTeam} vs ${m.awayTeam}
      </div>
      <div style="font-size:22px;font-weight:800;margin-bottom:6px;">
        ${home} - ${away}
      </div>
      <div class="sub">
        ${m.round} • ${formatDateTime(m.dateTime)} • ${m.field}
      </div>
      <div class="sub" style="margin-top:4px;">
        Stato: ${m.status} • Timer: ${formatTimer(m.seconds||0)}
      </div>
      <hr style="border:none;border-top:1px solid #262626;margin:8px 0;">
      <b>Formazione iniziale</b><br>
      ${lu.starters.length
        ? lu.starters.map(s=>`${s.role ? s.role+" – " : ""}${s.number} ${s.name}`).join("<br>")
        : "<span style='color:#999;'>Non ancora inserita.</span>"}
      <hr style="border:none;border-top:1px solid #262626;margin:8px 0;">
      <b>Panchina</b><br>
      ${lu.bench.length
        ? lu.bench.map(b=>`${b.number} ${b.name}`).join("<br>")
        : "—"}
      <hr style="border:none;border-top:1px solid #262626;margin:8px 0;">
      <b>Marcatori</b><br>
      ${marcatori}
      <hr style="border:none;border-top:1px solid #262626;margin:8px 0;">
      <b>Assist</b><br>
      ${assistHtml}
      <hr style="border:none;border-top:1px solid #262626;margin:8px 0;">
      <b>Cronaca</b><br>
      ${cronacaHtml}
    `;
  }

  function renderMatches(){
    const box=document.getElementById("matchesList");
    box.innerHTML="";
    matches.forEach(m=>{
      const home=(m.homeScore==null)?"-":m.homeScore;
      const away=(m.awayScore==null)?"-":m.awayScore;
      const label=
        m.status==="FIN" ? "Terminata" :
        m.status==="PRE" ? "Da giocare" :
        "LIVE";
      const pillClass=
        m.status==="FIN" ? "pill pill-fin" :
        m.status==="PRE" ? "pill pill-pre" :
        "pill pill-live";

      const card=document.createElement("div");
      card.className="match-card";
      card.innerHTML=`
        <div class="match-header">
          <div>
            <div class="match-round">${m.round} — ${m.category}</div>
            <div class="sub">${formatDateTime(m.dateTime)} • ${m.field}</div>
          </div>
          <div class="${pillClass}">${label}</div>
        </div>
        <div class="teams-row">
          <div class="team-name ${m.homeTeam.includes("San Siro")?"sansiro":""}">${m.homeTeam}</div>
          <div class="score">${home} - ${away}</div>
          <div class="team-name ${m.awayTeam.includes("San Siro")?"sansiro":""}">${m.awayTeam}</div>
        </div>
      `;
      box.appendChild(card);
    });
  }

  function renderAll(){
    matches = loadMatches();
    renderCountdown();
    renderTodayMatch();
    renderMatches();
  }

  function pollStorage(){
    renderAll();
  }

  window.addEventListener("load",()=>{
    renderAll();
    setInterval(pollStorage,3000);
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Admin Diretta San Siro U14</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    :root { color-scheme: dark; }
    * { box-sizing:border-box; }
    body {
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#050505;
      color:#f5f5f5;
    }
    header{
      background:#000;
      padding:10px 14px;
      border-bottom:1px solid #222;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .brand{font-weight:700;font-size:16px;letter-spacing:0.06em;}
    .brand span{color:#e50914;}
    main{
      max-width:900px;
      margin:0 auto;
      padding:14px 10px 40px;
    }
    h2{font-size:18px;margin:14px 0 8px;}
    .box{
      background:#181818;
      border-radius:10px;
      border:1px solid #262626;
      padding:10px 12px;
      margin-bottom:10px;
      font-size:14px;
    }
    label{display:block;font-size:13px;margin-bottom:4px;}
    select, input[type="text"], input[type="number"]{
      width:100%;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #444;
      background:#101010;
      color:#f5f5f5;
      margin-bottom:6px;
    }
    .row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:6px;
    }
    .row button{
      flex:1;
      min-width:120px;
    }
    button{
      padding:7px 10px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
    }
    .btn-main{background:#e50914;color:#fff;}
    .btn-sec{background:#222;color:#eee;border:1px solid #444;}
    .btn-fin{background:#2e7d32;color:#fff;}
    .btn-reset{background:#555;color:#fff;}
    .info-line{font-size:13px;color:#ccc;margin:3px 0;}
    .evt-row{font-size:13px;border-bottom:1px solid #262626;padding:3px 0;}
    #loginBox{
      max-width:400px;
      margin:80px auto;
      background:#181818;
      border-radius:10px;
      border:1px solid #262626;
      padding:20px 16px;
      text-align:center;
    }
    #loginBox input{
      width:100%;
      padding:8px 10px;
      margin-top:10px;
      border-radius:8px;
      border:1px solid #444;
      background:#101010;
      color:#f5f5f5;
    }
    #loginBox button{
      margin-top:12px;
      width:100%;
    }
  </style>
</head>
<body>
<header>
  <div class="brand">ADMIN <span>SAN SIRO</span> U14</div>
  <div style="font-size:12px;color:#aaa;">Solo per mister / staff – dati salvati in questo browser</div>
</header>

<div id="loginBox">
  <h2>Accesso admin</h2>
  <div style="font-size:13px;color:#ccc;">Inserisci la password per gestire la diretta.</div>
  <input type="password" id="adminPass" placeholder="Password">
  <button class="btn-main" onclick="checkLogin()">Entra</button>
</div>

<main id="adminPage" style="display:none;">

  <div class="box">
    <h2>Partita da gestire</h2>
    <label for="matchSelect">Seleziona partita</label>
    <select id="matchSelect" onchange="changeMatch()"></select>
    <div class="info-line" id="mInfo"></div>
    <div class="info-line" id="mScore"></div>
    <div class="info-line" id="mStatus"></div>
    <div class="info-line" id="mTimer"></div>
  </div>

  <div class="box">
    <h2>Timer (MM:SS)</h2>
    <div class="info-line">Usa START/STOP/RESET. Il valore viene salvato e letto dalla home.</div>
    <div style="font-size:24px;font-weight:700;margin:6px 0;" id="timerDisplay">00:00</div>
    <div class="row">
      <button class="btn-main" onclick="startTimer()">START</button>
      <button class="btn-sec" onclick="stopTimer()">STOP</button>
      <button class="btn-reset" onclick="resetTimer()">RESET</button>
      <button class="btn-fin" onclick="finishMatch()">FINE PARTITA</button>
    </div>
  </div>

  <div class="box">
    <h2>Gol & Risultato</h2>
    <div class="row">
      <button class="btn-main" onclick="addGoal('home')">+ Gol San Siro</button>
      <button class="btn-sec" onclick="addGoal('away')">+ Gol Avversari</button>
    </div>
    <div class="info-line" style="margin-top:8px;">
      Verranno aggiornati: risultato, marcatori, assist e cronaca (minuto automatico).
    </div>
  </div>

  <div class="box">
    <h2>Cronaca libera</h2>
    <label for="evtText">Testo azione (es: "Occasione Ronda, tiro di poco a lato")</label>
    <input type="text" id="evtText" placeholder="Scrivi l'evento...">
    <button class="btn-sec" style="margin-top:6px;width:100%;" onclick="addCustomEvent()">Aggiungi alla cronaca</button>
    <div style="margin-top:10px;font-size:13px;color:#ccc;">
      Ultimi eventi:
    </div>
    <div id="evtList"></div>
  </div>

</main>

<script>
  /* === CONFIG DATI, STESSI DI index.html === */
  const STORAGE_KEY = "ssn_matches_v2";
  const ADMIN_PASS = "0102030499";

  function defaultLineup() {
    return {
      starting: [
        "1 - Micucci Emanuele (POR)",
        "6 - Maro Terenui Luca (DC)",
        "11 - Rebaudengo Amedeo (TS)",
        "25 - Panebianco Edoardo (TD)",
        "8 - Vitarelli Alessandro (TRQ)",
        "4 - Meazzi Timoteo (TRQ)",
        "10 - Ronda Rocco (FW)"
      ],
      bench: [
        "99 - Vitarelli Andrea",
        "12 - Perez Sanabria Erik Joshue",
        "5 - Risso Leonardo",
        "35 - Buzzi Diego",
        "7 - Lanini Gabriele",
        "4 - Cerfogli Elio"
      ]
    };
  }

  const baseMatches = [
    {
      id: 1,
      round: "1ª giornata",
      dateTime: "2025-10-18T10:00:00",
      category: "U14",
      field: "Campo Meja",
      homeTeam: "San Marziano",
      awayTeam: "San Siro Nervi U14",
      homeScore: 1,
      awayScore: 1,
      status: "FIN",
      seconds: 0,
      goals: [
        { team: "away", name: "Edoardo Panebianco", goals: 1 }
      ],
      assists: [
        { team: "away", name: "Meazzi Timoteo", assists: 1 }
      ],
      events: [],
      lineup: defaultLineup()
    },
    {
      id: 2,
      round: "2ª giornata",
      dateTime: "2025-10-26T16:30:00",
      category: "U14",
      field: "Campo Emiliani",
      homeTeam: "San Siro Nervi U14",
      awayTeam: "Fulgor Gialli U14",
      homeScore: 8,
      awayScore: 1,
      status: "FIN",
      seconds: 0,
      goals: [
        { team: "home", name: "Meazzi Timoteo", goals: 5 },
        { team: "home", name: "Ronda Rocco", goals: 1 },
        { team: "home", name: "Rebaudengo Amedeo", goals: 1 },
        { team: "home", name: "Vitarelli Andrea", goals: 1 }
      ],
      assists: [
        { team: "home", name: "Buzzi Diego", assists: 1 },
        { team: "home", name: "Vitarelli Alessandro", assists: 2 },
        { team: "home", name: "Rebaudengo Amedeo", assists: 3 }
      ],
      events: [],
      lineup: defaultLineup()
    },
    {
      id: 3,
      round: "3ª giornata",
      dateTime: "2025-11-09T10:00:00",
      category: "U14",
      field: "Sestri Ponente",
      homeTeam: "San Giovanni Battista U14",
      awayTeam: "San Siro Nervi U14",
      homeScore: 5,
      awayScore: 6,
      status: "FIN",
      seconds: 0,
      goals: [
        { team: "away", name: "Ronda Rocco", goals: 4 },
        { team: "away", name: "Vitarelli Andrea", goals: 1 },
        { team: "away", name: "Vitarelli Alessandro", goals: 1 }
      ],
      assists: [
        { team: "away", name: "Lanini Gabriele", assists: 1 },
        { team: "away", name: "Vitarelli Alessandro", assists: 1 },
        { team: "away", name: "Rebaudengo Amedeo", assists: 1 }
      ],
      events: [],
      lineup: defaultLineup()
    },
    {
      id: 4,
      round: "4ª giornata",
      dateTime: "2025-11-23T16:30:00",
      category: "U14",
      field: "Campo Emiliani",
      homeTeam: "San Siro Nervi U14",
      awayTeam: "Genova SC Albaro",
      homeScore: null,
      awayScore: null,
      status: "PRE",
      seconds: 0,
      goals: [],
      assists: [],
      events: [],
      lineup: defaultLineup()
    },
    {
      id: 5,
      round: "5ª giornata",
      dateTime: "2025-11-30T10:30:00",
      category: "U14",
      field: "Campo Fumeri",
      homeTeam: "Fulgor Verdi U14",
      awayTeam: "San Siro Nervi U14",
      homeScore: null,
      awayScore: null,
      status: "PRE",
      seconds: 0,
      goals: [],
      assists: [],
      events: [],
      lineup: defaultLineup()
    },
    {
      id: 6,
      round: "6ª giornata (riposo)",
      dateTime: "2025-12-14T00:00:00",
      category: "U14",
      field: "Riposo",
      homeTeam: "San Siro Nervi U14",
      awayTeam: "—",
      homeScore: null,
      awayScore: null,
      status: "PRE",
      seconds: 0,
      goals: [],
      assists: [],
      events: [],
      lineup: defaultLineup()
    },
    {
      id: 7,
      round: "7ª giornata",
      dateTime: "2025-12-21T16:30:00",
      category: "U14",
      field: "Campo Emiliani",
      homeTeam: "San Siro Nervi U14",
      awayTeam: "Polisportiva Pieve",
      homeScore: null,
      awayScore: null,
      status: "PRE",
      seconds: 0,
      goals: [],
      assists: [],
      events: [],
      lineup: defaultLineup()
    }
  ];

  function deepClone(obj){return JSON.parse(JSON.stringify(obj));}

  function loadMatches(){
    try{
      const raw=localStorage.getItem(STORAGE_KEY);
      if(!raw) return deepClone(baseMatches);
      const parsed=JSON.parse(raw);
      if(!Array.isArray(parsed)||!parsed.length) return deepClone(baseMatches);
      return parsed;
    }catch(e){
      return deepClone(baseMatches);
    }
  }
  function saveMatches(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(matches));
  }

  let matches = loadMatches();
  let currentId = 4; // per oggi di default
  let timerInterval = null;
  let lastTickTime = null;

  /* === LOGIN === */
  function checkLogin(){
    const v = document.getElementById("adminPass").value.trim();
    if(v === ADMIN_PASS){
      document.getElementById("loginBox").style.display="none";
      document.getElementById("adminPage").style.display="block";
      initAdmin();
    } else {
      alert("Password errata");
    }
  }

  function formatDateTime(dtStr){
    const d = new Date(dtStr);
    if(isNaN(d.getTime())) return dtStr;
    const gg=String(d.getDate()).padStart(2,"0");
    const mm=String(d.getMonth()+1).padStart(2,"0");
    const hh=String(d.getHours()).padStart(2,"0");
    const mi=String(d.getMinutes()).padStart(2,"0");
    return `${gg}/${mm}/${d.getFullYear()} • ${hh}:${mi}`;
  }
  function formatTimer(sec){
    const s=sec||0;
    const mm=String(Math.floor(s/60)).padStart(2,"0");
    const ss=String(s%60).padStart(2,"0");
    return `${mm}:${ss}`;
  }

  function statusLabel(m){
    if(m.status==="FIN")return"Terminata";
    if(m.status==="PRE")return"In programma";
    if(m.status==="LIVE")return"LIVE";
    return m.status||"";
  }

  function initAdmin(){
    const sel = document.getElementById("matchSelect");
    sel.innerHTML = "";
    matches
      .slice()
      .sort((a,b)=>new Date(a.dateTime)-new Date(b.dateTime))
      .forEach(m=>{
        const opt=document.createElement("option");
        opt.value=m.id;
        opt.textContent=`${m.round} – ${m.homeTeam} vs ${m.awayTeam}`;
        sel.appendChild(opt);
      });
    // seleziona default (4 o il primo)
    const exists = matches.find(m=>m.id===currentId);
    if(!exists) currentId = matches[0].id;
    sel.value = currentId;
    renderMatch();
  }

  function getCurrent(){
    return matches.find(m=>m.id===Number(currentId));
  }

  function changeMatch(){
    currentId = Number(document.getElementById("matchSelect").value);
    stopTimer(); // per sicurezza
    renderMatch();
  }

  function renderMatch(){
    const m = getCurrent();
    if(!m)return;
    document.getElementById("mInfo").textContent =
      `${m.round} • ${formatDateTime(m.dateTime)} • ${m.field}`;
    const scoreText =
      (m.homeScore==null || m.awayScore==null) ? "- : -" : `${m.homeScore} - ${m.awayScore}`;
    document.getElementById("mScore").textContent =
      `${m.homeTeam} ${scoreText} ${m.awayTeam}`;
    document.getElementById("mStatus").textContent = `Stato: ${statusLabel(m)}`;
    document.getElementById("mTimer").textContent = `Timer salvato: ${formatTimer(m.seconds||0)}`;
    document.getElementById("timerDisplay").textContent = formatTimer(m.seconds||0);

    // cronaca breve
    const list = document.getElementById("evtList");
    const evts = (m.events||[]).slice().sort((a,b)=>(a.minute||0)-(b.minute||0));
    list.innerHTML = evts.length
      ? evts.slice(-5).map(e=>`<div class="evt-row"><b>${e.minute}'</b> ${e.text}</div>`).join("")
      : "<div class='evt-row' style='color:#aaa;'>Ancora nessuna cronaca.</div>";
  }

  /* TIMER SEMPLICE */
  function startTimer(){
    const m = getCurrent();
    if(!m)return;
    if(m.status==="FIN"){
      alert("La partita è già segnata come FINITA.");
      return;
    }
    m.status="LIVE";
    if(timerInterval) return;
    lastTickTime = Date.now();
    timerInterval = setInterval(()=>{
      const now=Date.now();
      const diff = Math.floor((now-lastTickTime)/1000);
      if(diff>0){
        m.seconds = (m.seconds||0) + diff;
        lastTickTime = now;
        saveMatches();
        document.getElementById("timerDisplay").textContent = formatTimer(m.seconds||0);
        document.getElementById("mTimer").textContent = `Timer salvato: ${formatTimer(m.seconds||0)}`;
        document.getElementById("mStatus").textContent = `Stato: ${statusLabel(m)}`;
      }
    },1000);
  }

  function stopTimer(){
    if(timerInterval){
      clearInterval(timerInterval);
      timerInterval=null;
    }
    lastTickTime=null;
    saveMatches();
    renderMatch();
  }

  function resetTimer(){
    const m=getCurrent(); if(!m)return;
    if(!confirm("Azzero il timer e riporto lo stato a PRE?")) return;
    m.seconds=0;
    m.status="PRE";
    stopTimer();
  }

  function finishMatch(){
    const m=getCurrent(); if(!m)return;
    if(!confirm("Segno la partita come TERMINATA?")) return;
    m.status="FIN";
    stopTimer();
  }

  /* GOL & CRONACA */
  function addGoal(team){
    const m=getCurrent(); if(!m)return;
    const who = prompt(team==="home" ? "Nome marcatore San Siro:" : "Nome marcatore avversari:");
    if(!who) return;
    const assist = prompt("Assist (lascia vuoto se nessuno):");
    const minute = Math.floor((m.seconds||0)/60);

    // aggiorno risultato
    if(team==="home"){
      m.homeScore = (m.homeScore==null ? 0 : m.homeScore) + 1;
    }else{
      m.awayScore = (m.awayScore==null ? 0 : m.awayScore) + 1;
    }

    // aggiorno lista marcatori
    if(!m.goals) m.goals=[];
    let g = m.goals.find(x=>x.name===who && x.team===team);
    if(!g){
      g = {team, name:who, goals:0};
      m.goals.push(g);
    }
    g.goals += 1;

    // assist
    if(assist && assist.trim()){
      if(!m.assists) m.assists=[];
      let a = m.assists.find(x=>x.name===assist.trim());
      if(!a){
        a={name:assist.trim(), assists:0};
        m.assists.push(a);
      }
      a.assists += 1;
    }

    // evento cronaca
    if(!m.events) m.events=[];
    m.events.push({
      minute: minute,
      text: team==="home"
        ? `GOL SAN SIRO – ${who}${assist? " (assist "+assist+")":""}`
        : `Gol avversari – ${who}${assist? " (assist "+assist+")":""}`
    });

    saveMatches();
    renderMatch();
  }

  function addCustomEvent(){
    const m=getCurrent(); if(!m)return;
    const txt = document.getElementById("evtText").value.trim();
    if(!txt) return;
    const minute = Math.floor((m.seconds||0)/60);
    if(!m.events) m.events=[];
    m.events.push({minute, text:txt});
    document.getElementById("evtText").value="";
    saveMatches();
    renderMatch();
  }

  // Se avevi già aperto l'admin nello stesso browser, puoi saltare il login
  window.addEventListener("load", ()=>{
    // niente auto-login per sicurezza, ma potresti salvarlo se vuoi
  });
</script>
</body>
</html>
